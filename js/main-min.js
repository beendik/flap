function flap(){function t(){context.clearRect(0,0,canvas.width,canvas.height),s+=r,r+=.8,(u+1)%10||!x||(f=-f,v=!v,x=!1),v?f-=.002*Math.log(u+5):f+=.002*Math.log(u+5),i(),l.forEach(function(t){t.updatePos(f),t.draw(),t.x+t.width<=0&&!v?(t.width=40+Math.floor(40*Math.random()),t.height=10+Math.floor(170*Math.random()),t.updatePos(-(canvas.width+t.width))):t.x+t.width>=canvas.width&&v&&(t.width=40+Math.floor(40*Math.random()),t.height=10+Math.floor(170*Math.random()),t.updatePos(canvas.width+t.width)),n(t)}),a(),s+h>=canvas.height&&(r=0,s=canvas.height-h,w=!1),lost||requestAnimationFrame(t)}function e(){context.font="60px Helvetica Neue",context.textAlign="center",context.fillStyle="#aaa",context.fillText("Du tapte.",canvas.width/2,canvas.height/2),lost=!0,document.addEventListener("mousedown",startClickHandler,!1),document.addEventListener("touchstart",startClickHandler,!1)}function n(t){t.x<=d+h&&t.x>=d-t.width?(t.inside=!0,s+h>=canvas.height-t.height&&!isGracePeriod(u)&&e()):!0===t.inside&&(t.inside=!1,u+=1,x=!0)}function a(){u>highScore&&(highScore=u),context.fillStyle="#666",context.font="32px Helvetica Neue",context.textAlign="center",context.fillText(String(u),80,80),context.fillStyle="#aaa",context.fillText(String(highScore),canvas.width-80,80)}function i(){context.fillStyle="#133686",context.fillRect(d,s,h,h)}function o(t){if(!isTouchDevice()||"mousedown"!==t.type){if("keydown"===t.type)if(82===t.keyCode)flap();else if(32!==t.keyCode)return;s===canvas.height-h?r=-20:w||(r=-15,w=!0),lost&&t.target===canvas&&flap(),lost=!1}}function c(t){this.x=t,this.width=40+Math.floor(40*Math.random()),this.height=10+Math.floor(130*Math.random()),this.inside=!1,this.updatePos=function(t){this.x-=t},this.draw=function(){context.fillStyle="#aaa",isGracePeriod(u)&&(context.fillStyle="#133686",context.fillText("Grace",canvas.width/2,canvas.height/2),context.fillStyle="#bff2e8"),context.fillRect(this.x,canvas.height-this.height,this.width,this.height)}}document.querySelector(".play").blur(),lost=!1,document.removeEventListener("mousedown",startClickHandler),document.removeEventListener("touchstart",startClickHandler);var h=20,d=350-h/2,s=canvas.height-h,l=[new c(canvas.width),new c(canvas.width+350)],r=0,u=0,f=6,v=!1,x=!1,w=!0;document.addEventListener("mousedown",o,!1),document.addEventListener("touchstart",o,!1),document.addEventListener("keydown",o,!1),t()}function startClickHandler(t){isTouchDevice()&&"mousedown"===t.type||t.target===canvas&&flap()}var canvas=document.querySelector(".game"),context=canvas.getContext("2d"),highScore=0,lost=!1;document.addEventListener("mousedown",startClickHandler,!1),document.addEventListener("touchstart",startClickHandler,!1);