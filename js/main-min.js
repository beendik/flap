function flap(){function t(){context.clearRect(0,0,canvas.width,canvas.height),h+=u,u+=.4,(v+1)%10||!g||(f=-f,x=!x,g=!1),a(),l.forEach(function(t){t.updatePos(f),t.draw(),(t.x+t.width<=0&&!x||t.x>=canvas.width&&x)&&(t.width=50,t.height=10+Math.floor(230*Math.random()),t.topHeight=canvas.height-t.height-50*Math.random()-100,x?t.updatePos(canvas.width+t.width+350):t.updatePos(-(canvas.width+t.width+350))),n(t)}),i(),h>=canvas.height?e():h<=0&&(h=0),lost||requestAnimationFrame(t)}function e(){context.font="60px Helvetica Neue",context.textAlign="center",context.fillStyle="#666",context.fillText("Du tapte.",canvas.width/2,canvas.height/2),lost=!0,document.addEventListener("mousedown",startClickHandler,!1),document.addEventListener("touchstart",startClickHandler,!1),document.addEventListener("keydown",startClickHandler,!1)}function n(t){t.x<=d+s&&t.x>=d-t.width?(t.inside=!0,(h+s-5>=canvas.height-t.height||h+5<=t.topHeight)&&!isGracePeriod(v)&&e()):!0===t.inside&&(t.inside=!1,v+=1,g=!0,x?f-=.1:f+=.1)}function i(){v>highScore&&(highScore=v),context.fillStyle="#666",context.font="32px Helvetica Neue",context.textAlign="center",context.fillText(String(v),80,80),context.fillStyle="#aaa",context.fillText(String(highScore),canvas.width-80,80)}function a(){context.fillStyle="#133686",context.save(),context.translate(d+s/2,h+s/2),x&&context.scale(-1,1),context.rotate(u/30),context.drawImage(r,-s/2,-s/2,s,s),context.restore()}function o(t){if(!isTouchDevice()||"mousedown"!==t.type){if("keydown"===t.type)if(82===t.keyCode)flap();else if(32!==t.keyCode)return;u=-8,lost&&t.target===canvas&&flap(),lost=!1}}function c(t){this.x=t,this.width=50,this.height=10+Math.floor(230*Math.random()),this.inside=!1,this.topHeight=canvas.height-this.height-50*Math.random()-100,this.updatePos=function(t){this.x-=t},this.draw=function(){context.fillStyle="#aaa",isGracePeriod(v)&&(context.fillStyle="#bff2e8"),context.fillRect(this.x,canvas.height-this.height,this.width,this.height),context.fillRect(this.x,0,this.width,this.topHeight)}}document.querySelector(".play").blur(),lost=!1,document.removeEventListener("mousedown",startClickHandler),document.removeEventListener("touchstart",startClickHandler),document.removeEventListener("keydown",startClickHandler);var s=40,d=350-s/2,h=canvas.height/20-100,r=new Image(s,s);r.src="js/flappy.png";var l=[new c(canvas.width+100),new c(canvas.width+650)],u=-2,v=0,f=6,x=!1,g=!1;document.addEventListener("mousedown",o,!1),document.addEventListener("touchstart",o,!1),document.addEventListener("keydown",o,!1),t()}function startClickHandler(t){isTouchDevice()&&"mousedown"===t.type||("keydown"===t.type&&32==t.keyCode&&flap(),t.target===canvas&&flap())}var canvas=document.querySelector(".game"),context=canvas.getContext("2d"),highScore=0,lost=!1;document.addEventListener("mousedown",startClickHandler,!1),document.addEventListener("touchstart",startClickHandler,!1),document.addEventListener("keydown",startClickHandler,!1);