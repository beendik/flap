function fall(){function t(){o+=h,h+=.8,r+=.001*l,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#133686",ctx.fillRect(s,o,c,c),u.forEach(function(t){t.updatePos(r),t.draw(),t.x+t.width<=0&&t.updatePos(-(canvas.width+t.width)),t.x<=s+c&&t.x>=s-t.width?(t.inside=!0,o+c>=canvas.height-t.height&&e()):!0===t.inside&&(t.inside=!1,l+=1)}),a(),o+c>=canvas.height&&(h=0,o=canvas.height-c,d=!1),tapt||requestAnimationFrame(t)}function e(){ctx.font="60px Helvetica Neue",ctx.textAlign="center",ctx.fillStyle="#aaa",ctx.fillText("Du tapte.",canvas.width/2,canvas.height/2),tapt=!0,a(),lost()}function a(){l>highscore&&(highscore=l),ctx.fillStyle="#666",ctx.font="32px Helvetica Neue",ctx.textAlign="center",ctx.fillText(l,80,80),ctx.fillStyle="#aaa",ctx.fillText(highscore,canvas.width-80,80)}function n(t){if(!isTouchDevice()||"mousedown"!==t.type){if("keydown"===t.type)if(82===t.keyCode)fall();else if(32!==t.keyCode)return;o===canvas.height-c?h=-20:d||(h=-15,d=!0),tapt&&t.target===canvas&&fall(),tapt=!1}}function i(t){this.x=t,this.width=50+Math.floor(80*Math.random()),this.height=50+Math.floor(100*Math.random()),this.inside=!1,this.updatePos=function(t){this.x-=t},this.draw=function(){ctx.fillStyle="#aaa",ctx.fillRect(this.x,canvas.height-this.height,this.width,this.height)}}tapt=!1,document.removeEventListener("mousedown",startClickHandler),document.removeEventListener("touchstart",startClickHandler);var c=20,s=50,o=canvas.height-c,d=!0,h=0,l=0,r=6,u=[new i(canvas.width-225),new i(canvas.width+125)];document.querySelector(".play").blur(),document.addEventListener("mousedown",n,!1),document.addEventListener("touchstart",n,!1),document.addEventListener("keydown",n,!1),t()}function startClickHandler(t){isTouchDevice()&&"mousedown"===t.type||t.target===canvas&&fall()}function lost(){document.addEventListener("mousedown",startClickHandler,!1),document.addEventListener("touchstart",startClickHandler,!1)}var canvas=document.querySelector(".game"),ctx=canvas.getContext("2d"),highscore=0,tapt=!1;document.addEventListener("mousedown",startClickHandler,!1),document.addEventListener("touchstart",startClickHandler,!1);