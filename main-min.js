function isTouchDevice(){return"ontouchstart"in document.documentElement}function fall(){function t(){ctx.fillStyle="green",r+=v,v+=.8,s-=x+.5*f,ctx.clearRect(0,0,canvas.width,canvas.height),ctx.fillStyle="#133686",ctx.fillRect(50,r,i,i),ctx.fillStyle="#aaa",ctx.fillRect(s,canvas.height-o,l,o),a(),r+i>=canvas.height&&(v=0,r=canvas.height-i,h=!1),s+l<=0&&(s=canvas.width,o=50+Math.floor(100*Math.random()),l=50+Math.floor(80*Math.random())),s<=50+i&&s>=50-l?(d=!0,r+i>=canvas.height-o&&e()):!0===d&&(d=!1,f+=1),u||requestAnimationFrame(t)}function e(){ctx.font="60px Helvetica Neue",ctx.textAlign="center",ctx.fillStyle="#aaa",ctx.fillText("Du tapte.",canvas.width/2,canvas.height/2),u=!0,a()}function a(){f>highscore&&(highscore=f),ctx.fillStyle="#666",ctx.font="32px Helvetica Neue",ctx.textAlign="center",ctx.fillText(f,80,80),ctx.fillStyle="#aaa",ctx.fillText(highscore,canvas.width-80,80)}function n(t){if(!isTouchDevice()||"mousedown"!==t.type){if("keydown"===t.type)if(82===t.keyCode)fall();else if(32!==t.keyCode)return;r===canvas.height-i?v=-20:h||(v=-15,h=!0),u&&t.target===canvas&&fall(),u=!1}}function c(){}document.removeEventListener("mousedown",startClickHandler),document.removeEventListener("touchstart",startClickHandler);var i=20,l=80,o=200,r=canvas.height-i-1,s=canvas.width,d=!1,h=!0,u=!1,v=0,f=0,x=8;document.querySelector(".play").blur(),document.addEventListener("mousedown",n,!1),document.addEventListener("touchstart",n,!1),document.addEventListener("keydown",n,!1),t()}function startClickHandler(t){isTouchDevice()&&"mousedown"===t.type||t.target!==canvas||started||(fall(),started=!0)}var canvas=document.querySelector(".game"),ctx=canvas.getContext("2d"),highscore=0,started=!1;document.addEventListener("mousedown",startClickHandler,!1),document.addEventListener("touchstart",startClickHandler,!1);